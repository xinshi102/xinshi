```mermaid
graph TD
    A[训练配置] --> A1[训练轮数: 100]
    A --> A2[批次大小: 32]
    A --> A3[优化器: Adam]
    A --> A4[设备: CPU]
    
    B[数据准备] --> B1[训练集:验证集 = 4:1]
    B --> B2[DataLoader批处理]
    B --> B3[数据标准化]
    B --> B4[数据编码]
    
    C[模型初始化] --> C1[设置随机种子]
    C --> C2[初始化模型参数]
    C --> C3[指定训练设备]
    
    D[训练循环] --> E[前向传播]
    E --> E1[LSTM时序特征提取]
    E1 --> E2[Dropout正则化]
    E2 --> E3[序列长度统一为72]
    E3 --> E4[全连接层降维]
    E4 --> E5[注意力机制]
    
    E5 --> F1[天气分类预测]
    E5 --> F2[温度湿度预测]
    E5 --> F3[降水量预测]
    
    F1 --> G1[交叉熵损失]
    F2 --> G2[MSE损失]
    F3 --> G3[加权Huber损失]
    
    G1 --> H1[基础分类损失]
    G1 --> H2[层次距离矩阵]
    H1 --> H3[层次惩罚]
    H2 --> H3
    H3 --> I[总损失计算]
    
    G2 --> I
    G3 --> I
    
    I --> J[反向传播]
    J --> J1[清空梯度]
    J1 --> J2[计算梯度]
    J2 --> J3[Adam优化器更新]
    
    J3 --> K[模型评估]
    K --> L[保存模型]
```

## 损失函数说明

### 1. 天气分类损失
- 基础交叉熵损失
- 层次距离矩阵惩罚
- 总损失 = 基础损失 + 层次惩罚

### 2. 温度湿度预测损失
- MSE损失
- 范围约束
- ReLU惩罚

### 3. 降水量预测损失
- 加权Huber损失
- 有雨样本权重: 3.0
- 无雨样本权重: 1.0

## 模型结构说明

### 1. 特征提取
- LSTM层
- Dropout正则化
- 序列长度: 72时间步

### 2. 预测分支
- 天气分类器
- 温度湿度回归器
- 降水量回归器

### 3. 注意力机制
- 时间步注意力
- 降水量特征注意力 