```mermaid
graph TD
    A[训练循环] --> B[前向传播]
    
    B --> C1[LSTM时序特征提取]
    C1 --> C2[Dropout正则化]
    C2 --> C3[序列长度统一为72]
    C3 --> C4[全连接层降维]
    C4 --> C5[任务共享特征]
    
    C5 --> D1[时间步注意力机制]
    C5 --> D2[降水特征注意力机制]
    
    D1 --> E1[天气分类预测]
    D1 --> E2[温度预测]
    D1 --> E3[湿度预测]
    D2 --> E4[降水量预测]
    
    E4 --> F1[基于降水量预测天气]
    E1 --> F1
    F1 --> F2[融合天气预测结果]
    
    E2 --> G1[温度MSE损失]
    E3 --> G2[湿度MSE损失]
    F2 --> G3[天气分类损失]
    E4 --> G4[降水量损失]
    
    G1 --> H1[温度范围约束]
    G2 --> H2[湿度范围约束]
    G3 --> H3[层次距离矩阵]
    G4 --> H4[样本权重调整]
    
    H1 --> I[总损失计算]
    H2 --> I
    H3 --> I
    H4 --> I
    
    I --> J[反向传播]
    J --> J1[清空梯度]
    J1 --> J2[计算多任务梯度]
    J2 --> J3[Adam优化器更新]
    
    J3 --> K[模型评估]
```

## 训练循环说明

### 1. 前向传播
- LSTM特征提取
- Dropout正则化
- 序列长度统一化
- 特征降维
- 双注意力机制

### 2. 预测分支
- 天气分类预测
- 温度预测
- 湿度预测
- 降水量预测
- 预测结果融合

### 3. 损失计算
- 温度MSE损失 + 范围约束
- 湿度MSE损失 + 双ReLU约束
- 天气分类损失 + 层次矩阵
- 降水量加权Huber损失

### 4. 反向传播
- 梯度清零
- 多任务梯度计算
- Adam参数更新 